- name: Add MYSQL repository
  yum_repository:
    name: MySQL
    description: MySQL repo
    baseurl: http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/
    enabled: yes
    gpgcheck: no
    file: mysql

- name: Remove Mariadb Libraries
  yum:
    name: mariadb-libs
    state: absent

- name: Install MySQL Server
  yum:
    name:
     - mysql-community-server
     - MySQL-python
    state: present

- name: Start MySQL Service
  systemd:
    state: started
    name: mysqld
    enabled: yes

- name: Grabbing Default password
  shell: grep "A temporary password" /var/log/mysqld.log | awk '{print $NF}'
  register: MYSQL_DEFAULT_PASSWORD

- name: Copy Password Reset SQL script
  copy:
    src: mysql-pass-reset.sql
    dest: /tmp/mysql-pass-reset.sql

- name: Set MySQL root Password
  shell: mysql --connect-expired-password -u root -p"{{MYSQL_DEFAULT_PASSWORD.stdout}}" < /tmp/mysql-pass-reset.sql